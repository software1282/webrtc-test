<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agora 1:1 Audio Call</title>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
</head>
<body>
    <h2>Agora 1:1 Audio Call</h2>
    <button onclick="joinCall()">Join Call</button>
    <button onclick="leaveCall()">Leave Call</button>

    <script>
        const APP_ID = "your-agora-app-id";
        const CHANNEL_NAME = "test-channel";
        const UID = Math.floor(Math.random() * 1000);
        const SERVER_URL = "";

        let client, localAudioTrack;

        async function joinCall() {
            const res = await fetch(`/token?channel=${CHANNEL_NAME}&uid=${UID}`);
            const { token } = await res.json();

            client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
            await client.join(APP_ID, CHANNEL_NAME, token, UID);

            localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
            await client.publish([localAudioTrack]);

            client.on("user-published", async (user, mediaType) => {
                await client.subscribe(user, mediaType);
                if (mediaType === "audio") {
                    user.audioTrack.play();
                }
            });
        }

        async function leaveCall() {
            if (localAudioTrack) {
                localAudioTrack.close();
            }
            await client.leave();
        }
    </script>
</body>
</html>
